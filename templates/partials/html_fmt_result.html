{{ if .error }}
    <div class="mb-4 p-4 bg-red-50 border border-red-200 rounded-lg">
        <div class="flex items-center">
            <svg class="w-5 h-5 text-red-500 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
            <div>
                <h3 class="text-sm font-medium text-red-800">{{ call .T "html_error_title" }}</h3>
                <p class="text-sm text-red-700 mt-1">{{ .error }}</p>
                {{ if and .line .column (gt .line 0) }}
                    <p class="text-xs text-red-600 mt-1">{{ call .T "html_error_position" }}: {{ .line }}:{{ .column }}</p>
                {{ end }}
            </div>
        </div>
    </div>
{{ else }}
    <div class="mb-4">
        <div class="flex justify-between items-center mb-2">
            <label class="block text-sm font-medium text-slate-700">{{ call .T "html_output_label" }}</label>
            <button type="button" onclick="copyResult()" class="px-3 py-1 bg-indigo-100 text-indigo-700 text-xs font-medium rounded hover:bg-indigo-200 transition-colors">
                {{ call .T "copy" }}
            </button>
        </div>
        <div class="relative">
            <div class="flex border border-slate-300 rounded-lg bg-slate-50">
                <!-- Line Numbers -->
                <div class="flex flex-col bg-slate-100 border-r border-slate-200 select-none" style="min-width: 3rem;">
                    <div id="output-line-numbers" class="px-2 py-4 text-right text-xs text-slate-500 font-mono leading-6">
                        <!-- Line numbers will be populated by JavaScript -->
                    </div>
                </div>
                <!-- Syntax Highlighted Output -->
                <div class="flex-1 overflow-auto">
                    <pre id="output-content" class="w-full h-full p-4 bg-slate-50 font-mono text-sm text-slate-700"><code class="language-html">{{ .result }}</code></pre>
                </div>
            </div>
        </div>
        <div class="mt-2 text-xs text-slate-500">
            {{ $lines := len (split .result "\n") }}
            {{ $chars := len .result }}
            {{ $stats := call .T "html_output_stats" }}
            {{ if eq $stats "html_output_stats" }}
                {{ $lines }} lines, {{ $chars }} characters
            {{ else }}
                {{ $stats }}
            {{ end }}
        </div>
    </div>

    <script>
        // Update output line numbers
        function updateOutputLineNumbers() {
            const outputContent = document.getElementById('output-content');
            const lineNumbers = document.getElementById('output-line-numbers');
            
            if (outputContent && lineNumbers) {
                const lines = outputContent.textContent.split('\n');
                const lineCount = lines.length;
                
                let lineNumbersHTML = '';
                for (let i = 1; i <= lineCount; i++) {
                    if (i > 1) lineNumbersHTML += '<br>';
                    lineNumbersHTML += i;
                }
                lineNumbers.innerHTML = lineNumbersHTML;
            }
        }

        // Copy result to clipboard
        function copyResult() {
            const outputContent = document.getElementById('output-content');
            if (outputContent) {
                const text = outputContent.textContent;
                navigator.clipboard.writeText(text).then(function() {
                    const button = event.target;
                    const originalText = button.textContent;
                    button.textContent = '{{ call .T "copied" }}';
                    button.classList.add('bg-green-100', 'text-green-700');
                    button.classList.remove('bg-indigo-100', 'text-indigo-700');
                    
                    setTimeout(function() {
                        button.textContent = originalText;
                        button.classList.remove('bg-green-100', 'text-green-700');
                        button.classList.add('bg-indigo-100', 'text-indigo-700');
                    }, 2000);
                }).catch(function(err) {
                    console.error('Failed to copy text: ', err);
                });
            }
        }

        // Initialize line numbers
        document.addEventListener('DOMContentLoaded', function() {
            updateOutputLineNumbers();
        });
    </script>
{{ end }}