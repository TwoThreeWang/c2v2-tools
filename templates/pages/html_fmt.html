{{ define "html_fmt.html" }}
<!DOCTYPE html>
<html lang="{{ .lang }}">
{{ template "head" . }}
    <script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/js-beautify/1.14.7/beautify-html.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css">

<body class="bg-slate-50 text-slate-900 antialiased flex flex-col min-h-screen">
    {{ template "header" . }}

    <main class="max-w-6xl mx-auto px-4 py-8 flex-grow">
        <div class="max-w-5xl mx-auto">
            
            <!-- Breadcrumbs -->
            <nav class="flex text-sm text-slate-500 mb-4" aria-label="Breadcrumb">
                <ol class="inline-flex items-center space-x-1 md:space-x-3">
                    <li class="inline-flex items-center">
                        <a href="{{ call .L "/" }}" class="hover:text-indigo-600 transition-colors">
                            {{ call .T "breadcrumb_home" }}
                        </a>
                    </li>
                    <li>
                        <div class="flex items-center">
                            <svg class="w-3 h-3 text-slate-400 mx-1" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 6 10">
                                <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 9 4-4-4-4"/>
                            </svg>
                            <a href="{{ call .L "/" }}#popular" class="ml-1 hover:text-indigo-600 transition-colors">{{ call .T "nav_dev_tools" }}</a>
                        </div>
                    </li>
                    <li aria-current="page">
                        <div class="flex items-center">
                            <svg class="w-3 h-3 text-slate-400 mx-1" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 6 10">
                                <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 9 4-4-4-4"/>
                            </svg>
                            <span class="ml-1 text-slate-700 font-medium">HTML</span>
                        </div>
                    </li>
                </ol>
            </nav>

            <!-- Hero Header -->
            <header class="mb-6 text-center">
                <h1 class="text-2xl font-bold text-slate-900 mb-2">{{ call .T "tool_html_title" }}</h1>
                <p class="text-slate-500 text-sm">{{ call .T "tool_html_desc" }}</p>
            </header>

            <!-- Tool Interface -->
            <div class="bg-white rounded-xl border border-slate-200 overflow-hidden shadow-sm">
                <form class="p-5">
                    
                    <!-- Action Buttons -->
                    <div class="flex flex-wrap gap-2 mb-4">
                        <button type="button" onclick="processHTML('format')" class="px-4 py-2 bg-indigo-600 text-white text-sm font-medium rounded-lg hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 transition-colors">
                            {{ call .T "html_format" }}
                        </button>
                        <button type="button" onclick="processHTML('minify')" class="px-4 py-2 bg-slate-600 text-white text-sm font-medium rounded-lg hover:bg-slate-700 focus:outline-none focus:ring-2 focus:ring-slate-500 focus:ring-offset-2 transition-colors">
                            {{ call .T "html_minify" }}
                        </button>
                        <button type="button" onclick="processHTML('escape')" class="px-4 py-2 bg-emerald-600 text-white text-sm font-medium rounded-lg hover:bg-emerald-700 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:ring-offset-2 transition-colors">
                            {{ call .T "html_escape" }}
                        </button>
                        <button type="button" onclick="processHTML('unescape')" class="px-4 py-2 bg-amber-600 text-white text-sm font-medium rounded-lg hover:bg-amber-700 focus:outline-none focus:ring-2 focus:ring-amber-500 focus:ring-offset-2 transition-colors">
                            {{ call .T "html_unescape" }}
                        </button>
                        <button type="button" onclick="clearAll()" class="px-4 py-2 bg-slate-200 text-slate-700 text-sm font-medium rounded-lg hover:bg-slate-300 focus:outline-none focus:ring-2 focus:ring-slate-400 focus:ring-offset-2 transition-colors">
                            {{ call .T "clear" }}
                        </button>
                        <button type="button" onclick="openPreview()" class="px-4 py-2 bg-blue-600 text-white text-sm font-medium rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors">
                            {{ call .T "html_preview" }}
                        </button>
                    </div>

                    <!-- Input Area -->
                    <div class="mb-4">
                        <label for="input-html" class="block text-sm font-medium text-slate-700 mb-2">{{ call .T "html_input_label" }}</label>
                        <div class="relative">
                            <div class="flex border border-slate-300 rounded-lg focus-within:ring-2 focus-within:ring-indigo-500 focus-within:border-indigo-500">
                                <!-- Line Numbers -->
                                <div class="flex flex-col bg-slate-100 border-r border-slate-200 select-none" style="min-width: 3rem;">
                                    <div id="input-line-numbers" class="px-2 py-4 text-right text-xs text-slate-500 font-mono leading-6">
                                        1
                                    </div>
                                </div>
                                <!-- Textarea -->
                                <textarea 
                                    id="input-html"
                                    name="input" 
                                    class="flex-1 p-4 pb-8 rounded-r-lg bg-transparent font-mono text-sm resize-none outline-none leading-6" 
                                    placeholder="{{ call .T "html_input_placeholder" }}"
                                    rows="12"
                                    oninput="updateInputStats(this); updateLineNumbers(this, 'input-line-numbers')"
                                    onscroll="syncScroll(this, 'input-line-numbers')"
                                    onkeyup="validateHTML()"
                                ></textarea>
                            </div>
                        </div>
                        <div class="mt-2 flex justify-between text-xs text-slate-500">
                            <span id="input-stats">{{ call .T "html_stats_empty" }}</span>
                            <span id="validation-status"></span>
                        </div>
                    </div>

                    <!-- Loading Indicator (Hidden by default) -->
                    <div id="loading-indicator" class="hidden mb-4">
                        <div class="flex items-center justify-center py-8">
                            <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600"></div>
                            <span class="ml-2 text-slate-600">{{ call .T "processing" }}</span>
                        </div>
                    </div>

                    <!-- Result Area (Hidden by default) -->
                    <div id="result-area" class="hidden mt-4 p-8 text-center text-slate-400 text-sm border-2 border-dashed border-slate-200 rounded-lg">
                        {{ call .T "html_result_placeholder" }}
                    </div>
                </form>
            </div>

            <!-- SEO Content Section -->
            {{ template "seo_content_section" (dict 
                "content_blocks" (list 
                    (dict 
                        "icon_path" "M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
                        "title" (call .T "html_seo_h2_what")
                        "content" (call .T "html_seo_p_what")
                    )
                    (dict 
                        "icon_path" "M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"
                        "title" (call .T "html_seo_h2_use")
                        "content" (call .T "html_seo_p_use")
                    )
                )
                "faq_items" (list 
                    (dict 
                        "question" (call .T "html_seo_faq_1_q")
                        "answer" (call .T "html_seo_faq_1_a")
                    )
                    (dict 
                        "question" (call .T "html_seo_faq_2_q")
                        "answer" (call .T "html_seo_faq_2_a")
                    )
                )
            ) }}
        </div>
    </main>

    {{ template "footer" . }}

    <script>
        // Update input statistics
        function updateInputStats(textarea) {
            const text = textarea.value;
            const lines = text.split('\n').length;
            const chars = text.length;
            const words = text.trim() ? text.trim().split(/\s+/).length : 0;
            
            const statsElement = document.getElementById('input-stats');
            if (text.trim() === '') {
                statsElement.textContent = '{{ call .T "html_stats_empty" }}';
            } else {
                statsElement.textContent = `{{ call .T "html_stats_format" }}`.replace('{lines}', lines).replace('{chars}', chars).replace('{words}', words);
            }
        }

        // Update line numbers
        function updateLineNumbers(textarea, lineNumbersId) {
            const lineNumbers = document.getElementById(lineNumbersId);
            if (!lineNumbers) return;
            
            const lines = textarea.value.split('\n');
            const lineCount = lines.length;
            
            let lineNumbersHTML = '';
            for (let i = 1; i <= lineCount; i++) {
                if (i > 1) lineNumbersHTML += '<br>';
                lineNumbersHTML += i;
            }
            lineNumbers.innerHTML = lineNumbersHTML;
        }

        // Sync scroll between textarea and line numbers
        function syncScroll(textarea, lineNumbersId) {
            const lineNumbers = document.getElementById(lineNumbersId);
            if (lineNumbers) {
                lineNumbers.scrollTop = textarea.scrollTop;
            }
        }

        // Clear all content
        function clearAll() {
            document.getElementById('input-html').value = '';
            document.getElementById('result-area').innerHTML = '';
            document.getElementById('validation-status').innerHTML = '';
            updateInputStats(document.getElementById('input-html'));
            updateLineNumbers(document.getElementById('input-html'), 'input-line-numbers');
        }

        // Toggle preview
        function togglePreview() {
            const previewContainer = document.getElementById('preview-container');
            const toggleButton = event.target;
            
            if (previewContainer.classList.contains('hidden')) {
                previewContainer.classList.remove('hidden');
                toggleButton.textContent = '{{ call .T "html_hide_preview" }}';
                updatePreview();
            } else {
                previewContainer.classList.add('hidden');
                toggleButton.textContent = '{{ call .T "html_toggle_preview" }}';
            }
        }

        // Process HTML (format, minify, escape, unescape)
        function processHTML(action) {
            const textarea = document.getElementById('input-html');
            const input = textarea.value;
            if (!input.trim()) {
                alert('{{ call .T "html_input_empty" }}');
                return;
            }

            let result = '';
            
            try {
                switch(action) {
                    case 'format':
                        result = html_beautify(input, {
                            indent_size: 2,
                            indent_char: ' ',
                            max_preserve_newlines: 1,
                            preserve_newlines: true,
                            keep_array_indentation: false,
                            break_chained_methods: false,
                            indent_scripts: 'normal',
                            brace_style: 'collapse',
                            space_before_conditional: true,
                            unescape_strings: false,
                            jslint_happy: false,
                            end_with_newline: false,
                            wrap_line_length: 0,
                            indent_inner_html: true,
                            comma_first: false,
                            e4x: false,
                            indent_empty_lines: false
                        });
                        break;
                    case 'minify':
                        // Simple HTML minification
                        result = input
                            .replace(/>\s+</g, '><') // Remove space between tags
                            .replace(/\s{2,}/g, ' ')  // Collapse multiple spaces
                            .replace(/<!\-\-[\s\S]*?\-\->/g, '') // Remove comments
                            .trim();
                        break;
                    case 'escape':
                        const div = document.createElement('div');
                        div.textContent = input;
                        result = div.innerHTML;
                        break;
                    case 'unescape':
                        const doc = new DOMParser().parseFromString(input, 'text/html');
                        result = doc.documentElement.textContent;
                        break;
                }

                if (result !== undefined) {
                    textarea.value = result;
                    updateInputStats(textarea);
                    updateLineNumbers(textarea, 'input-line-numbers');
                    
                    // Show success feedback in validation status briefly
                    const validationStatus = document.getElementById('validation-status');
                    const originalStatus = validationStatus.innerHTML;
                    validationStatus.innerHTML = '<span class="text-green-600">✓ Action applied</span>';
                    setTimeout(() => {
                        validationStatus.innerHTML = originalStatus;
                    }, 2000);
                }
            } catch (error) {
                const resultArea = document.getElementById('result-area');
                resultArea.innerHTML = '<div class="mb-4 p-4 bg-red-50 border border-red-200 rounded-lg"><p class="text-sm text-red-700">Error: ' + error.message + '</p></div>';
                resultArea.classList.remove('hidden');
            }
        }

        // Open preview in new tab
        function openPreview() {
            const input = document.getElementById('input-html').value;
            if (!input.trim()) {
                alert('{{ call .T "html_input_empty" }}');
                return;
            }

            const blob = new Blob([input], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            window.open(url, '_blank');
        }

        // Validate HTML
        function validateHTML() {
            const input = document.getElementById('input-html').value;
            const validationStatus = document.getElementById('validation-status');
            
            if (!input.trim()) {
                validationStatus.innerHTML = '';
                return;
            }

            // Simple validation - check for basic HTML structure
            const hasHTML = input.includes('<') && input.includes('>');
            const hasDoctype = input.toLowerCase().includes('<!doctype');
            
            if (hasHTML) {
                validationStatus.innerHTML = '<span class="text-green-600">✓ Valid HTML</span>';
            } else {
                validationStatus.innerHTML = '<span class="text-amber-600">⚠ No HTML tags detected</span>';
            }
        }

        // Copy result
        function copyResult() {
            const input = document.getElementById('input-html');
            input.select();
            document.execCommand('copy');
            
            // Show feedback
            const button = event.target;
            const originalText = button.textContent;
            button.textContent = '{{ call .T "copied" }}';
            setTimeout(() => {
                button.textContent = originalText;
            }, 2000);
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            updateInputStats(document.getElementById('input-html'));
            updateLineNumbers(document.getElementById('input-html'), 'input-line-numbers');
        });
    </script>
</body>
</html>
{{ end }}