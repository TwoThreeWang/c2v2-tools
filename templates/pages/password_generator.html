{{ define "password_generator.html" }}
<!DOCTYPE html>
<html lang="{{ .lang }}">
{{ template "head" . }}

<body class="bg-slate-50 text-slate-900 antialiased flex flex-col min-h-screen">
    {{ template "header" . }}

    <main class="max-w-6xl mx-auto px-4 py-8 flex-grow">
        <div class="mx-auto">

            <!-- Breadcrumbs -->
            <nav class="flex text-sm text-slate-500 mb-4" aria-label="Breadcrumb">
                <ol class="inline-flex items-center space-x-1 md:space-x-3">
                    <li class="inline-flex items-center">
                        <a href="{{ call .L "/" }}" class="hover:text-indigo-600 transition-colors">
                            {{ call .T "breadcrumb_home" }}
                        </a>
                    </li>
                    <li>
                        <div class="flex items-center">
                            <svg class="w-3 h-3 text-slate-400 mx-1" aria-hidden="true"
                                xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 6 10">
                                <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"
                                    stroke-width="2" d="m1 9 4-4-4-4" />
                            </svg>
                            <a href="{{ call .L "/" }}#security"
                                class="ml-1 hover:text-indigo-600 transition-colors">{{ call .T "cat_security_title"
                                }}</a>
                        </div>
                    </li>
                    <li aria-current="page">
                        <div class="flex items-center">
                            <svg class="w-3 h-3 text-slate-400 mx-1" aria-hidden="true"
                                xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 6 10">
                                <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"
                                    stroke-width="2" d="m1 9 4-4-4-4" />
                            </svg>
                            <span class="ml-1 text-slate-700 font-medium">{{ call .T "tool_password_title" }}</span>
                        </div>
                    </li>
                </ol>
            </nav>

            <!-- Hero Header -->
            <header class="mb-8 text-center">
                <h1 class="text-3xl font-bold text-slate-900 mb-2">{{ call .T "tool_password_title" }}</h1>
                <p class="text-slate-500">{{ call .T "tool_password_desc" }}</p>
            </header>

            <!-- Generator Card -->
            <div class="bg-white rounded-xl border border-slate-200 shadow-sm p-6 md:p-8 mb-8">

                <!-- Display Area -->
                <div class="relative mb-8 group">
                    <div id="password-display"
                        class="w-full bg-slate-100 p-5 rounded-lg text-center font-mono text-2xl md:text-3xl break-all min-h-[5rem] flex items-center justify-center text-slate-800 tracking-wider">
                        <!-- Password will appear here -->
                    </div>

                    <button type="button" id="copy-btn" onclick="copyPassword()"
                        class="absolute top-2 right-2 p-2 text-slate-400 hover:text-indigo-600 bg-white rounded-md shadow-sm border border-slate-200 hover:border-indigo-200 transition-all opacity-0 group-hover:opacity-100 focus:opacity-100"
                        title="{{ call .T "pwd_copy_btn" }}">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z">
                            </path>
                        </svg>
                    </button>

                    <!-- Strength Meter -->
                    <div class="mt-2 flex items-center justify-between">
                        <div class="flex-grow flex gap-1 h-1.5 rounded-full overflow-hidden bg-slate-100 mr-4">
                            <div id="strength-bar-1" class="w-1/4 bg-slate-200 transition-colors duration-300"></div>
                            <div id="strength-bar-2" class="w-1/4 bg-slate-200 transition-colors duration-300"></div>
                            <div id="strength-bar-3" class="w-1/4 bg-slate-200 transition-colors duration-300"></div>
                            <div id="strength-bar-4" class="w-1/4 bg-slate-200 transition-colors duration-300"></div>
                        </div>
                        <span id="strength-text"
                            class="text-xs font-semibold text-slate-400 uppercase tracking-wide min-w-[3rem] text-right"></span>
                    </div>
                </div>

                <!-- Controls -->
                <div class="grid md:grid-cols-2 gap-8">
                    <!-- Length Slider -->
                    <div>
                        <div class="flex justify-between items-center mb-4">
                            <label for="length-slider" class="font-semibold text-slate-700">{{ call .T "pwd_length"
                                }}</label>
                            <span id="length-value" class="text-indigo-600 font-mono font-bold text-lg">16</span>
                        </div>
                        <input type="range" id="length-slider" min="6" max="64" value="16"
                            class="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-indigo-600"
                            oninput="updateLength(this.value); generatePassword();">
                    </div>

                    <!-- Checkboxes -->
                    <div class="space-y-3">
                        <label class="font-semibold text-slate-700 block mb-2">{{ call .T "pwd_options" }}</label>

                        <div class="grid grid-cols-2 gap-3">
                            <label class="flex items-center space-x-2 cursor-pointer">
                                <input type="checkbox" id="opt-uppercase" checked onchange="generatePassword()"
                                    class="w-4 h-4 text-indigo-600 rounded border-slate-300 focus:ring-indigo-500">
                                <span class="text-sm text-slate-600 select-none">{{ call .T "pwd_opt_uppercase"
                                    }}</span>
                            </label>
                            <label class="flex items-center space-x-2 cursor-pointer">
                                <input type="checkbox" id="opt-lowercase" checked onchange="generatePassword()"
                                    class="w-4 h-4 text-indigo-600 rounded border-slate-300 focus:ring-indigo-500">
                                <span class="text-sm text-slate-600 select-none">{{ call .T "pwd_opt_lowercase"
                                    }}</span>
                            </label>
                            <label class="flex items-center space-x-2 cursor-pointer">
                                <input type="checkbox" id="opt-numbers" checked onchange="generatePassword()"
                                    class="w-4 h-4 text-indigo-600 rounded border-slate-300 focus:ring-indigo-500">
                                <span class="text-sm text-slate-600 select-none">{{ call .T "pwd_opt_numbers" }}</span>
                            </label>
                            <label class="flex items-center space-x-2 cursor-pointer">
                                <input type="checkbox" id="opt-symbols" checked onchange="generatePassword()"
                                    class="w-4 h-4 text-indigo-600 rounded border-slate-300 focus:ring-indigo-500">
                                <span class="text-sm text-slate-600 select-none">{{ call .T "pwd_opt_symbols" }}</span>
                            </label>
                        </div>

                        <div class="pt-2 border-t border-slate-100 mt-2">
                            <label class="flex items-center space-x-2 cursor-pointer">
                                <input type="checkbox" id="opt-easy-read" onchange="generatePassword()"
                                    class="w-4 h-4 text-indigo-600 rounded border-slate-300 focus:ring-indigo-500">
                                <span class="text-sm text-slate-600 select-none">{{ call .T "pwd_opt_easy_read"
                                    }}</span>
                            </label>
                        </div>
                    </div>
                </div>

                <!-- Generate Button -->
                <div class="mt-8 flex justify-center">
                    <button type="button" onclick="generatePassword()"
                        class="px-8 py-3 bg-indigo-600 text-white font-bold rounded-lg shadow-lg shadow-indigo-200 hover:bg-indigo-700 hover:shadow-xl hover:-translate-y-0.5 transition-all text-lg flex items-center gap-2">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15">
                            </path>
                        </svg>
                        {{ call .T "pwd_generate_btn" }}
                    </button>
                </div>
            </div>

            <!-- History -->
            <div class="mb-12">
                <h3 class="text-sm font-semibold text-slate-500 uppercase tracking-wider mb-4">{{ call .T "pwd_history"
                    }}</h3>
                <div id="history-list" class="space-y-2">
                    <!-- History items will be inserted here -->
                </div>
            </div>

            <!-- SEO Content Section -->
            {{ template "seo_content_section" (dict
            "content_blocks" (list
            (dict
            "icon_path" `M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8
            0v4h8z`
            "title" (call .T "pwd_seo_h2_secure")
            "content" (call .T "pwd_seo_p_secure")
            )
            (dict
            "icon_path" `M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z`
            "title" (call .T "pwd_seo_h2_features")
            "content" (print `<ul>
                <li>` (call .T "pwd_seo_li_custom") `</li>
                <li>` (call .T "pwd_seo_li_easy") `</li>
                <li>` (call .T "pwd_seo_li_privacy") `</li>
            </ul>`)
            )
            )
            "faq_items" (list
            (dict
            "question" (call .T "pwd_seo_faq_1_q")
            "answer" (call .T "pwd_seo_faq_1_a")
            )
            )
            ) }}

            <!-- Trust Footer -->
            <div class="mt-8 text-center border-t border-slate-200 pt-8">
                <p class="text-sm text-slate-500 flex items-start justify-center gap-2">
                    <svg class="w-5 h-5 text-green-500 flex-shrink-0" fill="none" stroke="currentColor"
                        viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z">
                        </path>
                    </svg>
                    <span>{{ call .T "pwd_client_side_note" }}</span>
                </p>
            </div>

        </div>
    </main>

    {{ template "footer" . }}

    <script>
        const CHARSET = {
            uppercase: 'ABCDEFGHIJKLMNOPQRSTUVWXYZ',
            lowercase: 'abcdefghijklmnopqrstuvwxyz',
            numbers: '0123456789',
            symbols: '!@#$%^&*()_+~`|}{[]:;?><,./-='
        };

        const AMBIGUOUS = 'l1IO0';

        let history = [];

        function updateLength(val) {
            document.getElementById('length-value').innerText = val;
        }

        function generatePassword() {
            const length = parseInt(document.getElementById('length-slider').value);
            const useUpper = document.getElementById('opt-uppercase').checked;
            const useLower = document.getElementById('opt-lowercase').checked;
            const useNumbers = document.getElementById('opt-numbers').checked;
            const useSymbols = document.getElementById('opt-symbols').checked;
            const easyRead = document.getElementById('opt-easy-read').checked;

            let chars = '';
            if (useUpper) chars += CHARSET.uppercase;
            if (useLower) chars += CHARSET.lowercase;
            if (useNumbers) chars += CHARSET.numbers;
            if (useSymbols) chars += CHARSET.symbols;

            if (easyRead) {
                chars = chars.split('').filter(c => !AMBIGUOUS.includes(c)).join('');
            }

            if (!chars) {
                // Determine user language and show appropriate message
                // Since this is client-side, we can use a hardcoded fallback or try to detect
                // For simplicity, we just force one checkbox to be checked or show alert
                alert('Please select at least one character type.');
                document.getElementById('opt-lowercase').checked = true;
                return generatePassword();
            }

            let password = '';
            const randomValues = new Uint32Array(length);
            window.crypto.getRandomValues(randomValues);

            for (let i = 0; i < length; i++) {
                password += chars[randomValues[i] % chars.length];
            }

            // Display
            const displayEl = document.getElementById('password-display');
            displayEl.innerText = password;
            displayEl.classList.remove('opacity-50');

            // Analyze Strength
            analyzeStrength(password);

            // Add to History
            addToHistory(password);
        }

        function analyzeStrength(pwd) {
            let score = 0;
            if (pwd.length > 8) score++;
            if (pwd.length > 12) score++;
            if (pwd.length >= 16) score++;
            if (/[A-Z]/.test(pwd)) score++;
            if (/[0-9]/.test(pwd)) score++;
            if (/[^A-Za-z0-9]/.test(pwd)) score++;

            const bars = [
                document.getElementById('strength-bar-1'),
                document.getElementById('strength-bar-2'),
                document.getElementById('strength-bar-3'),
                document.getElementById('strength-bar-4')
            ];
            const textEl = document.getElementById('strength-text');

            // Reset
            bars.forEach(b => b.className = 'w-1/4 bg-slate-200 transition-colors duration-300');

            let color = 'bg-red-500';
            let label = '{{ call .T "pwd_strength_weak" }}';

            if (score > 4) {
                color = 'bg-green-500';
                label = '{{ call .T "pwd_strength_strong" }}';
            } else if (score > 2) {
                color = 'bg-yellow-500';
                label = '{{ call .T "pwd_strength_good" }}';
            }

            // Fill bars
            const fillCount = Math.min(4, Math.ceil(score / 1.5));
            for (let i = 0; i < fillCount; i++) {
                bars[i].classList.remove('bg-slate-200');
                bars[i].classList.add(color);
            }

            textEl.innerText = label;
            textEl.className = `text-xs font-semibold uppercase tracking-wide min-w-[3rem] text-right ${color.replace('bg-', 'text-')}`;
        }

        function addToHistory(pwd) {
            // Avoid duplicates at the top
            if (history.length > 0 && history[0] === pwd) return;

            history.unshift(pwd);
            if (history.length > 3) history.pop();

            renderHistory();
        }

        const TEXT_COPY_BTN = '{{ call .T "pwd_copy_btn" }}';

        function renderHistory() {
            const list = document.getElementById('history-list');
            list.innerHTML = '';

            history.forEach(pwd => {
                const item = document.createElement('div');
                item.className = 'flex items-center justify-between p-3 bg-white border border-slate-100 rounded-lg hover:border-indigo-100 transition-colors';

                // Truncate for display if too long
                const displayPwd = pwd.length > 40 ? pwd.substring(0, 40) + '...' : pwd;

                const code = document.createElement('code');
                code.className = 'font-mono text-slate-600 text-sm break-all mr-4';
                code.textContent = displayPwd;

                const btn = document.createElement('button');
                btn.className = 'text-xs font-medium text-indigo-600 hover:text-indigo-800 transition-colors whitespace-nowrap';
                btn.textContent = TEXT_COPY_BTN;
                btn.onclick = () => copyText(pwd, btn);

                item.appendChild(code);
                item.appendChild(btn);
                list.appendChild(item);
            });
        }

        async function copyPassword() {
            const pwd = document.getElementById('password-display').innerText;
            if (!pwd) return;
            await copyText(pwd, document.getElementById('copy-btn'));
        }

        async function copyText(text, btn) {
            try {
                await navigator.clipboard.writeText(text);

                // Button feedback
                const originalHtml = btn.innerHTML;

                // Handle both icon button and text button
                if (btn.id === 'copy-btn') {
                    btn.innerHTML = `<svg class="w-5 h-5 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>`;
                } else {
                    btn.innerText = '{{ call .T "pwd_copied" }}';
                    btn.classList.add('text-green-600');
                }

                setTimeout(() => {
                    btn.innerHTML = originalHtml;
                    if (btn.id !== 'copy-btn') btn.classList.remove('text-green-600');
                }, 2000);
            } catch (err) {
                console.error('Failed to copy', err);
            }
        }

        // Init
        window.addEventListener('DOMContentLoaded', () => {
            generatePassword();
        });
    </script>
</body>

</html>
{{ end }}